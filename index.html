<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Pattern Heat Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #0d1b2a; color: #e0e1dd; min-height: 100vh; padding: 10px; }
        
        .main-layout { display: flex; justify-content: center; gap: 15px; max-width: 1200px; margin: 0 auto; }
        .side-stats { width: 160px; display: flex; flex-direction: column; gap: 10px; }
        .container { flex: 1; max-width: 600px; }
        
        header { text-align: center; padding: 10px 0; }
        h1 { font-size: 1.5rem; color: #4cc9f0; }
        
        .trigger-panel {
            background: #1b263b; border: 2px solid #f72585; border-radius: 12px;
            padding: 15px; margin-bottom: 15px; min-height: 100px;
        }
        .trigger-item { 
            background: #f72585; color: white; padding: 5px 10px; 
            border-radius: 5px; margin: 5px; display: inline-block; font-weight: bold;
            animation: flash 1s infinite alternate;
        }
        @keyframes flash { from { opacity: 1; } to { opacity: 0.6; } }

        .results-section {
            background: rgba(13, 27, 42, 0.9); border-radius: 12px;
            padding: 15px; margin-bottom: 15px; border: 1px solid #1b4965;
        }
        .section-title { color: #72efdd; margin-bottom: 10px; font-size: 0.8rem; text-align: center; text-transform: uppercase; }
        
        .v-box { padding: 8px; border-radius: 6px; text-align: center; margin-bottom: 5px; font-size: 0.9rem; }
        .v-cold { background: #023e8a; border: 1px solid #4361ee; }

        .number-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 4px; margin-top: 10px; }
        .number-btn {
            aspect-ratio: 1; font-size: 0.8rem; font-weight: bold; border: none; border-radius: 4px;
            cursor: pointer; color: white; display: flex; align-items: center; justify-content: center;
        }
        .zero { background: #38b000; grid-column: span 12; height: 30px; margin-bottom: 5px; }
        .even { background: #1b263b; border: 1px solid #4361ee; }
        .odd { background: #4361ee; }
        
        .input-row { display: flex; gap: 8px; margin: 15px 0; }
        input { flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #4361ee; background: #1b263b; color: white; }
        .btn { padding: 8px 15px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; color: white; }
        .btn-load { background: #4361ee; }
        .btn-clear { background: #f72585; }

        .history-list { display: flex; flex-wrap: wrap; gap: 5px; font-size: 0.8rem; }
        .hist-chip { background: #4361ee; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>

<div class="main-layout">
    <div class="side-stats">
        <div class="section-title">Target Cold List</div>
        <div id="coldListUI"></div>
    </div>

    <div class="container">
        <header>
            <h1>PRO MULTI-TRACKER</h1>
            <div id="spinCount" style="color:#72efdd">Spins: 0</div>
        </header>

        <div class="section-title">ACTIVE TRIGGERS</div>
        <div class="trigger-panel" id="triggerPanel"></div>

        <div class="number-grid">
            <button class="number-btn zero" onclick="addNumber(0)">0</button>
            <div id="gridBody" style="display:contents"></div>
        </div>

        <div class="input-row">
            <input type="text" id="csvInput" placeholder="Paste history (e.g. 1,2,3)">
            <button class="btn btn-load" onclick="loadCSV()">Load</button>
            <button class="btn btn-clear" onclick="clearData()">Clear</button>
        </div>

        <div class="results-section">
            <div class="section-title">Recent History</div>
            <div class="history-list" id="historyList"></div>
        </div>
    </div>
</div>

<script>
    let history = [];
    
    // Mapping Functions
    const getSplit = (n) => n === 0 ? [] : [Math.ceil(n/2)]; // Simplified Split logic
    const getCorner = (n) => n === 0 ? [] : [Math.ceil(n/4)]; // Simplified Corner logic
    const getStreet = (n) => n === 0 ? 0 : Math.ceil(n/3);
    const getDS = (n) => n === 0 ? 0 : Math.ceil(n/6);
    const getDozen = (n) => n === 0 ? 0 : Math.ceil(n/12);
    const getCol = (n) => n === 0 ? 0 : (n % 3 === 0 ? 3 : n % 3);

    function addNumber(n) {
        history.push(n);
        analyze();
    }

    function loadCSV() {
        const val = document.getElementById('csvInput').value;
        val.split(',').forEach(v => {
            let n = parseInt(v.trim());
            if (!isNaN(n)) history.push(n);
        });
        analyze();
    }

    function clearData() {
        history = [];
        analyze();
    }

    function analyze() {
        if (history.length < 5) { updateDisplay([], []); return; }

        const counts = { num: {}, split: {}, corner: {}, street: {}, ds: {}, doz: {}, col: {} };
        
        // 1. Calculate frequencies for everything
        history.forEach(n => {
            counts.num[n] = (counts.num[n] || 0) + 1;
            getSplit(n).forEach(s => counts.split[s] = (counts.split[s] || 0) + 1);
            getCorner(n).forEach(c => counts.corner[c] = (counts.corner[c] || 0) + 1);
            if(n>0){
                let st = getStreet(n); counts.street[st] = (counts.street[st] || 0) + 1;
                let ds = getDS(n); counts.ds[ds] = (counts.ds[ds] || 0) + 1;
                let dz = getDozen(n); counts.doz[dz] = (counts.doz[dz] || 0) + 1;
                let cl = getCol(n); counts.col[cl] = (counts.col[cl] || 0) + 1;
            }
        });

        // 2. Identify Cold (Bottom 1 or 2 items based on your instructions)
        const getCold = (obj, limit) => Object.entries(obj).sort((a,b) => a[1]-b[1]).slice(0, limit).map(x => x[0]);
        
        const coldTracker = {
            num: getCold(counts.num, 2),
            split: getCold(counts.split, 2),
            corner: getCold(counts.corner, 2),
            street: getCold(counts.street, 2),
            ds: getCold(counts.ds, 2),
            doz: getCold(counts.doz, 1),
            col: getCold(counts.col, 1)
        };

        // 3. Trigger Logic
        const triggers = [];
        const lastSpin = history[history.length - 1];

        const checkTrigger = (label, currentVal, coldList, minGap, maxGap) => {
            if (coldList.includes(currentVal.toString())) {
                // Find previous occurrence
                let lastIdx = -1;
                for(let i = history.length - 2; i >= 0; i--) {
                    let prevVal;
                    if(label === "STR") prevVal = history[i];
                    if(label === "SPL") prevVal = getSplit(history[i])[0];
                    if(label === "CNR") prevVal = getCorner(history[i])[0];
                    if(label === "ST") prevVal = getStreet(history[i]);
                    if(label === "DS") prevVal = getDS(history[i]);
                    if(label === "DOZ") prevVal = getDozen(history[i]);
                    if(label === "COL") prevVal = getCol(history[i]);

                    if(prevVal == currentVal) {
                        lastIdx = i;
                        break;
                    }
                }

                if (lastIdx !== -1) {
                    let gap = (history.length - 1) - lastIdx;
                    if (gap >= minGap && gap <= maxGap) {
                        triggers.push(`${label} ${currentVal} (${gap} spins)`);
                    }
                }
            }
        };

        checkTrigger("STR", lastSpin, coldTracker.num, 2, 14);
        getSplit(lastSpin).forEach(s => checkTrigger("SPL", s, coldTracker.split, 2, 14));
        getCorner(lastSpin).forEach(c => checkTrigger("CNR", c, coldTracker.corner, 2, 14));
        if(lastSpin > 0) {
            checkTrigger("ST", getStreet(lastSpin), coldTracker.street, 2, 6);
            checkTrigger("DS", getDS(lastSpin), coldTracker.ds, 2, 6);
            checkTrigger("DOZ", getDozen(lastSpin), coldTracker.doz, 2, 4);
            checkTrigger("COL", getCol(lastSpin), coldTracker.col, 2, 4);
        }

        updateDisplay(triggers, coldTracker);
    }

    function updateDisplay(triggers, cold) {
        document.getElementById('triggerPanel').innerHTML = triggers.map(t => `<div class="trigger-item">${t}</div>`).join('');
        document.getElementById('spinCount').textContent = `Total Spins: ${history.length}`;
        
        let coldHtml = '';
        for(let type in cold) {
            coldHtml += `<div class="v-box v-cold"><strong>${type.toUpperCase()}:</strong> ${cold[type].join(', ')}</div>`;
        }
        document.getElementById('coldListUI').innerHTML = coldHtml;
        document.getElementById('historyList').innerHTML = history.slice(-20).map(n => `<div class="hist-chip">${n}</div>`).join('');
    }

    // Init Grid
    const grid = document.getElementById('gridBody');
    for (let i = 1; i <= 36; i++) {
        const btn = document.createElement('button');
        btn.className = `number-btn ${i % 2 === 0 ? 'even' : 'odd'}`;
        btn.textContent = i;
        btn.onclick = () => addNumber(i);
        grid.appendChild(btn);
    }
</script>

</body>
</html>
